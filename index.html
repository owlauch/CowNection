<!doctype html>
<html>

<head>
    <title>CowNection</title>
</head>

<body>
    <ul id="messages"></ul>
    <div id="chartContainer" style="height: 300px; width: 100%;"></div>
</body>
<footer>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script src="https://code.jquery.com/jquery-1.11.1.js"></script>
    <script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>
    <script>
        
$(function () {
    var dps = [];
    var chart = new CanvasJS.Chart("chartContainer", {
        title: {
            text: "CowNection"
        },
        axisY: {
            includeZero: false
        },
        data: [{
            type: "line",
            dataPoints: dps
        }]
    });

    var xVal = 0;
    var yVal = 100;
    var updateInterval = 1000;
    var dataLength = 20;
    var socket = io();
    $('form').submit(function () {
        socket.emit('chat message', $('#m').val());
        $('#m').val('');
        return false;
    });
    socket.on('chat message', function (msg) {
        dps.push({
            x: xVal,
            y: parseInt(msg)
        });
        xVal++;
    });
    var updateChart = function (count) {

        count = count || 1;
        if (dps.length > dataLength) {
            dps.shift();
        }
        for (var j = 0; j < count; j++) {
		yVal = yVal +  Math.round(5 + Math.random() *(-5-5));
		dps.push({
			x: xVal,
			y: yVal
		});
		xVal++;
	  }

        chart.render();
    };

    updateChart(dataLength);
    setInterval(function () { updateChart() }, updateInterval);
});

    </script>
</footer>